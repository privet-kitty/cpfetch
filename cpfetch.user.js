// ==UserScript==
// @name        cpfetch
// @version     0.3.3
// @author      Hugo Sansaqua
// @description Userscript for competitive programming: parse test cases and copy template to clipboard on various online judges
// @homepage    https://github.com/privet-kitty/cpfetch
// @match       https://atcoder.jp/*/tasks/*
// @match       https://*.codechef.com/*/problems/*
// @match       https://*.codechef.com/problems/*
// @match       https://yukicoder.me/problems/*
// @match       https://toph.co/p/*
// @match       https://toph.co/arena*
// @match       https://csacademy.com/contest/*/task/*
// @namespace   https://privet-kitty.github.io/
// @grant       GM_setClipboard
// @grant       GM_registerMenuCommand
// @grant       GM_getResourceText
// @resource    template https://raw.githubusercontent.com/privet-kitty/cl-competitive/master/non-module/template.lisp
// @resource    modOperations https://raw.githubusercontent.com/privet-kitty/cl-competitive/master/module/mod-operations.lisp
// @resource    increaseStack https://raw.githubusercontent.com/privet-kitty/cl-competitive/master/non-module/increase-space.lisp
// @downloadURL https://privet-kitty.github.io/cpfetch/cpfetch.user.js
// @updateURL   https://privet-kitty.github.io/cpfetch/cpfetch.meta.js
// ==/UserScript==

(()=>{"use strict";var e={714:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.siteAtCoder=void 0;const o=n(882);t.siteAtCoder={domain:"atcoder.jp",findTestCases:e=>{const t=e.cloneNode(!0);t.querySelectorAll(".div-btn-copy").forEach((e=>e.parentNode?.removeChild(e))),t.querySelectorAll(".btn-copy").forEach((e=>e.parentNode?.removeChild(e)));const n=[],s=[];return t.querySelectorAll("h3").forEach((e=>{const t=e.textContent?.normalize("NFKC");if(void 0!==t){if(/^.*(入力例|Sample Input)\s*[0-9]*\s*$/.test(t)){const t=e.parentNode?.querySelector("pre")?.textContent;null!=t&&n.push(o.prettify(t))}if(/^.*(出力例|Sample Output)\s*[0-9]*\s*$/.test(t)){const t=e.parentNode?.querySelector("pre")?.textContent;null!=t&&s.push(o.prettify(t))}}})),n.length===s.length?o.deleteDuplicateTestCases(o.zip(n,s)):(console.log("Failed to parse test cases."),[])},addCopyButton:(e,t)=>{const n=e.querySelector("span.h2");if(null===n)return;const s=o.createCopyButton(t);s.classList.add("btn","btn-default","btn-sm"),n.appendChild(s)}}},991:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.siteCodeChef=void 0;const o=n(882);t.siteCodeChef={domain:"codechef.com",findTestCases:e=>{const t=[],n=[];e.querySelectorAll("h3#exampleinput, h3#sampleinput").forEach((e=>{const n=e.nextElementSibling?.textContent;null!=n&&t.push(o.prettify(n))})),e.querySelectorAll("h3#exampleoutput, h3#sampleoutput").forEach((e=>{const t=e.nextElementSibling?.textContent;null!=t&&n.push(o.prettify(t))}));for(let s=1;s<1e3;s++){const r=e.getElementById(`exampleinput${s}`)?.nextElementSibling?.textContent,l=e.getElementById(`exampleoutput${s}`)?.nextElementSibling?.textContent;if(!r||!l)break;t.push(o.prettify(r)),n.push(o.prettify(l))}return t.length===n.length?o.zip(t,n):(console.log("Failed to parse test cases."),[])},addCopyButton:(e,t)=>{const n=e.querySelector("aside.sidebar");if(null===n)return;const s=o.createCopyButton(t);s.classList.add("button","grey"),n.appendChild(s)},isReady:e=>null!==e.querySelector("aside.sidebar"),isIncreaseStack:!0}},601:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.COPY_BUTTON_LABEL_COPIED=t.COPY_BUTTON_LABEL=t.COPY_BUTTON_ID=void 0,t.COPY_BUTTON_ID="cpfetchCopyButton",t.COPY_BUTTON_LABEL="Copy template to clipboard",t.COPY_BUTTON_LABEL_COPIED="Copied!"},59:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.siteCsAcademy=void 0;const o=n(882);t.siteCsAcademy={domain:"csacademy.com",findTestCases:e=>{const t=[],n=[],s=e.querySelectorAll("thead tr th");if("Input"===s[0].innerText&&"Output"===s[1].innerText){const e=s[0]?.parentNode?.parentNode;e instanceof Element&&e.nextElementSibling?.childNodes?.forEach((e=>{const[s,r]=e.childNodes;s instanceof HTMLElement&&r instanceof HTMLElement&&(t.push(o.prettify(s.innerText)),n.push(o.prettify(r.innerText)))}))}return console.log(t,n),t.length>0&&t.length===n.length?o.zip(t,n):(console.log("Failed to parse test cases."),[])},addCopyButton:(e,t)=>{e.querySelectorAll("h1").forEach((e=>((e,t)=>{if(null===e)return!1;if(null===e.parentNode)return!1;const n=o.createCopyButton(t);return e.parentNode.insertBefore(n,e.nextSibling),!0})(e,t)))},isReady:e=>{const t=e.querySelectorAll("thead tr th");return void 0!==t&&t.length>=2&&t[0]instanceof HTMLElement&&"Input"===t[0].innerText&&t[1]instanceof HTMLElement&&"Output"===t[1].innerText}}},607:(e,t,n)=>{const o=n(754),s=n(714),r=n(991),l=n(62),c=n(59),i=n(848),a=new URL(document.URL).hostname;[s.siteAtCoder,r.siteCodeChef,l.siteYukicoder,c.siteCsAcademy,i.siteToph].forEach((e=>{new RegExp(e.domain).test(a)&&o.setUpSite(e)}))},754:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.setUpSite=void 0;const o=n(601),s=n(882),r=({findTestCases:e,addCopyButton:t,isIncreaseStack:n})=>{if(null!==document.getElementById(o.COPY_BUTTON_ID))return void console.log("Copy button already exists.");const r=()=>{const t=e(document),o=n?GM_getResourceText("increaseStack"):"";GM_setClipboard(s.createTemplate(t,o)),console.log("copied")};t(document,r),GM_registerMenuCommand(o.COPY_BUTTON_LABEL,r,"c")};t.setUpSite=e=>{const{isReady:t}=e;void 0===t?r(e):new MutationObserver(((n,o)=>{t(document,n,o)&&(console.log("isReady() succeeded"),o.disconnect(),r(e))})).observe(document,{childList:!0,subtree:!0}),window.addEventListener("keydown",(t=>{"t"===t.key&&r(e)}))}},848:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.siteToph=void 0;const o=n(882);t.siteToph={domain:"toph.co",findTestCases:e=>{const t=[],n=[];for(let n=0;n<1e3;n++){const s=e.getElementById(`preSample${n}Input`);if(null===s)break;null!==s.textContent&&t.push(o.prettify(s.textContent))}for(let t=0;t<1e3;t++){const s=e.getElementById(`preSample${t}Output`);if(null===s)break;null!==s.textContent&&n.push(o.prettify(s.textContent))}return console.log(t,n),t.length===n.length?o.zip(t,n):(console.log("Failed to parse test cases."),[])},addCopyButton:(e,t)=>{e.querySelectorAll("h1").forEach((e=>{console.log(e.textContent),((e,t)=>{if(null===e)return!1;if(null===e.parentNode)return!1;const n=o.createCopyButton(t);n.classList.add("btn","default"),e.parentNode.insertBefore(n,e.nextSibling)})(e,t)}))}}},882:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.createCopyButton=t.zip=t.deleteDuplicateTestCases=t.prettify=t.createTemplate=t.findMod=t.formatTestForm=void 0;const o=n(601);t.formatTestForm=e=>{const t=e=>e.replace('"','\\"');let n=";; To run: (5am:run! :sample)\n#+swank\n(5am:test :sample\n";return e.forEach((([e,o])=>{n+=((e,t)=>`  (5am:is\n   (equal "${t}"\n          (run "${e}" nil)))\n`)(t(e),t(o))})),"\n"===n[n.length-1]&&(n=n.slice(0,-1)),n+=")\n",n},t.findMod=e=>{const t=[],n=t=>t.some((t=>e.search(new RegExp("(^|[^\\d])"+t.source+"($|[^\\d])"))>=0));return n([/998,?244,?353/])?t.push(998244353):n([/163,?577,?857/])?t.push(163577857):n([/1,?000,?000,?007/,/10\^[\s{]*9[\s}]*\+[\s]*7/])?t.push(1000000007):n([/1,?000,?000,?009/,/10\^[\s{]*9[\s}]*\+[\s]*9/])?t.push(1000000009):n([/10,?007/])&&t.push(10007),1===t.length?t[0]:null};const s=(e,t,n)=>e.slice(0,n)+t+e.slice(n);t.createTemplate=(e,n)=>{const o=t.formatTestForm(e);return n+(e=>{const n=t.findMod(document.body.textContent??"");if(null===n)return e;{console.log(`Use ${n} as modulus`);let t=e.replace("1000000007",String(n));const o="BEGIN_INSERTED_CONTENTS",r=GM_getResourceText("modOperations")+"\n(define-mod-operations cl-user::+mod+ :cl-user)\n\n";t=s(t,r,t.search(o)+o.length+1);const l="BEGIN_USE_PACKAGE";return t=s(t,"(eval-when (:compile-toplevel :load-toplevel :execute)\n(use-package :cp/mod-operations :cl-user))\n",t.search(l)+l.length+1),t}})(GM_getResourceText("template")).replace("PROBLEM_URL_TO_BE_REPLACED",document.URL)+"\n"+o},t.prettify=e=>{const t=e.replace("/\r\n?/","\n").replace(/^\s+/,"").replace(/\s+$/,"");return 0===t.length||"\n"!==t[t.length-1]?t+"\n":t},t.deleteDuplicateTestCases=e=>{const t=[],n=new Set;return e.forEach((([e,o])=>{n.has(e)||(n.add(e),t.push([e,o]))})),t},t.zip=(e,t)=>e.map(((n,o)=>[e[o],t[o]])),t.createCopyButton=e=>{const t=document.createElement("button");return t.id=o.COPY_BUTTON_ID,t.innerHTML=o.COPY_BUTTON_LABEL,t.addEventListener("click",e),t}},62:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.siteYukicoder=void 0;const o=n(882);t.siteYukicoder={domain:"yukicoder.me",findTestCases:e=>{const t=[],n=[];return e.querySelectorAll("h6").forEach((e=>{const s=e.textContent?.normalize("NFKC");if(void 0!==s){if(/入力/.test(s)){const n=e.nextElementSibling?.textContent;null!=n&&t.push(o.prettify(n))}if(/出力/.test(s)){const t=e.nextElementSibling?.textContent;null!=t&&n.push(o.prettify(t))}}})),t.length===n.length?o.zip(t,n):(console.log("Failed to parse test cases."),[])},addCopyButton:(e,t)=>{e.querySelectorAll("h3").forEach((e=>{null!==e.textContent&&/No./.test(e.textContent)&&((e,t)=>{if(null===e)return!1;const n=o.createCopyButton(t);e.parentNode?.insertBefore(n,e.nextSibling)})(e,t)}))}}}},t={};!function n(o){if(t[o])return t[o].exports;var s=t[o]={exports:{}};return e[o](s,s.exports,n),s.exports}(607)})();